<html>

<head>

    <!--------------- 通用 --------------->

    <script type="text/javascript" src="./common/camera.js"></script>
    <script type="text/javascript" src="./common/context.js"></script>
    <script type="text/javascript" src="./common/gl-matrix-2.2.1.js"></script>
    <script type="text/javascript" src="./common/mesh.js"></script>
    <script type="text/javascript" src="./common/program.js"></script>

    <!--------------- 各种形状 --------------->
    <script type="text/javascript" src="./shape/sdf_border.js"></script>
    <script type="text/javascript" src="./shape/sdf_fast_border.js"></script>
    <script type="text/javascript" src="./shape/color_material.js"></script>
    <script type="text/javascript" src="./shape/sdf_round_rect.js"></script>
    <script type="text/javascript" src="./shape/sdf_fast_round_rect.js"></script>
    <script type="text/javascript" src="./shape/sdf_pie.js"></script>
    <script type="text/javascript" src="./shape/sdf_arc.js"></script>
    <script type="text/javascript" src="./shape/sdf_circle.js"></script>
    <script type="text/javascript" src="./shape/sdf_ellipse.js"></script>
    <script type="text/javascript" src="./shape/sdf_rect.js"></script>

    <!--------------- Shader --------------->

    <script type="text/javascript" src="./shader/color.vs.js"></script>
    <script type="text/javascript" src="./shader/color.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_pie.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_arc.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_round_rect.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_fast_round_rect.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_border.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_fast_border.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_circle.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_ellipse.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf_rect.fs.js"></script>
    <script type="text/javascript" src="./shader/sdf.vs.js"></script>

    <script type="text/javascript">
        function webGLStart() {
            let canvas = document.getElementById("png_demo");
            let context = Context.create(canvas);

            // addSdfCircle(context, 50, 500, 60, 0);

            radius = [0, 0, 50, 50, 50, 50, 50, 50];
            let borderSizes = [37, 37, 37, 37];
            let x = 51;
            let y = 54;
            let angle = 0;
            let scale = 0.359;
            addSdfBorder(context, 367.21154, 297.125, radius, borderSizes, x, y, angle, scale);
            
            x = 451;
            y = 254;
            angle = 0;
            scale = 1.0;
            addSdfBorder(context, 167.21154, 137.125, radius, borderSizes, x, y, angle, scale);

            radius = [30, 30, 20, 30, 20, 20, 30, 30];
            borderSizes = [17, 10, 8, 17];
            x = 400;
            y = 551;
            angle = 0;
            scale = 2.0;
            // addSdfBorder(context, 56.21154, 165.125, radius, borderSizes, x, y, angle, scale);
            
            radius = [230, 150, 0, 0, 230, 150, 0, 0];
            borderSizes = [40, 20, 10, 5];
            x = 31.1245;
            y = 11.2474;
            angle = 0;
            scale = 4.0;
            addSdfBorder(context, 197.21154, 265.125, radius, borderSizes, x, y, angle, scale);

            radius = [30, 30, 60, 30];
            borderSizes = 15;
            // addSdfFastBorder(context, 197.21154, 165.125, radius, borderSizes, 100.1245, 202.2474, 0);

            borderSizes = [30, 40, 40, 30, 30, 40, 40, 30];
            // addSdfRoundRect(context, 131, 71, radius, 100.54548, 100.22415, 0);
            // addSdfRoundRect(context, 131.215, 71.15, radius, 300.684548, 100.22415, 0);

            radius = [10, 20, 10, 20];
            // addSdfFastRoundRect(context, 131.245, 71.648, radius, 101.54548, 101.22415, 0);
            radius = [30, 20, 30, 20];
            // addSdfFastRoundRect(context, 131.215, 71.15, radius, 303.684548, 100.22415, 0);

            radius = 200;
            let radPie = 10 * Math.PI / 180;
            let radAxis = 10 * Math.PI / 180;
            // addSdfPie(context, radius, radPie, radAxis, 100, 100, 0);

            // let radius = 200;
            // let halfWidth = 6;
            // let isFlat = true;
            // let radArc = Math.PI / 6;
            // let radAxis = Math.PI / 3;
            // addSdfArc(context, radius, halfWidth, isFlat, radArc, radAxis, 100, 100, 0);

            // addSdfRect(context, canvas.width, canvas.height, canvas.width / 2, canvas.height / 2, 0);

            // addSdfEllipse(context, 90, 30, 100, 100, Math.PI / 16);
            // addSdfEllipse(context, 50, 25, 300, 300, -Math.PI / 4);

            drawScene(context);
        }

        let frame = 0;
        let lastTime = 0;

        function drawScene(context) {
            requestAnimationFrame(() => {
                frame++;
                drawScene(context);
                let now = performance.now();
                let tm = now - lastTime;
                if (tm > 1000) {
                    console.warn("fps: " + Math.round(frame * 1000 / tm * 10) / 10);
                    lastTime = now;
                    frame = 0;
                }
            });

            context.draw();
        }

        function addSdfEllipse(context, a, b, x, y, rad, color) {
            if (!color) {
                color = [1.0, 0.0, 0.0, 1.0];
            }

            let padding = 3;

            let e = SdfEllipse.create(context.gl, a, b, padding);

            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [2 * a + padding, 2 * b + padding, 1.0]);

            e.material.setWorldMatrix(m);
            e.material.setColor(...color);

            context.addMesh(e);
        }

        function addSdfCircle(context, r, x, y, rad, color) {
            if (!color) {
                color = [1.0, 0.0, 0.0, 1.0];
            }

            let padding = 3;

            let c = SdfCircle.create(context.gl, r, padding);

            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [2 * r + padding, 2 * r + padding, 1.0]);

            c.material.setWorldMatrix(m);
            c.material.setColor(...color);

            context.addMesh(c);
        }

        function addSdfRect(context, w, h, x, y, rad, color) {

            if (!color) {
                color = [1.0, 0.0, 0.0, 1.0];
            }

            let padding = 3;

            let r = SdfRect.create(context.gl, w, h, padding);

            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [w + padding, h + padding, 1.0]);

            r.material.setWorldMatrix(m);
            r.material.setColor(...color);

            context.addMesh(r);
        }

        function addSdfRect(context, w, h, x, y, rad, color) {
            if (!color) {
                color = [1.0, 0.0, 0.0, 1.0];
            }

            let padding = 3;

            let r = SdfRect.create(context.gl, w, h, padding);

            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [w + padding, h + padding, 1.0]);

            r.material.setWorldMatrix(m);
            r.material.setColor(...color);

            context.addMesh(r);
        }

        function addSdfArc(context, radius, halfWidth, isFlat, radArc, radAxis, x, y, rad, color) {
            if (!color) {
                color = [1.0, 0.0, 0.0, 1.0];
            }

            let r = SdfArc.create(context.gl, radius, halfWidth, isFlat, radArc, radAxis);

            let m = mat4.create();
            let width = 2 * radius + halfWidth * 2;
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [width, width, 1.0]);

            r.mesh.setDrawCount(1);
            r.mesh.material.setWorldMatrix(m);
            r.mesh.material.setColor(...color);

            context.addMesh(r);
        }

        function addSdfPie(context, radius, radPie, radAxis, x, y, rad, color) {

            if (!color) {
                color = [0.0, 1.0, 0.0, 1.0];
            }

            let r = SdfPie.create(context.gl, radius, radPie, radAxis);

            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [2 * radius, 2 * radius, 1.0]);

            r.mesh.setDrawCount(1);
            r.mesh.material.setWorldMatrix(m);
            r.mesh.material.setColor(...color);

            context.addMesh(r);
        }

        function addSdfFastRoundRect(context, w, h, borders, x, y, rad, color) {

            if (!color) {
                color = [0.0, 1.0, 0.0, 1.0];
            }

            let r = SdfFastRoundRect.create(context.gl, w, h, borders);

            let s = 1;
            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [s * w, s * h, 1.0]);

            r.mesh.setDrawCount(1);
            r.mesh.material.setWorldMatrix(m);
            r.mesh.material.setColor(...color);

            context.addMesh(r);
        }

        function addSdfRoundRect(context, w, h, borders, x, y, rad, color) {

            if (!color) {
                color = [0.0, 1.0, 0.0, 1.0];
            }

            let r = SdfRoundRect.create(context.gl, w, h, borders);

            let s = 1;
            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [s * w, s * h, 1.0]);

            r.mesh.setDrawCount(1);
            r.mesh.material.setWorldMatrix(m);
            r.mesh.material.setColor(...color);

            context.addMesh(r);
        }
        function addSdfFastBorder(context, w, h, radius, borderSize, x, y, rad, color) {
            if (!color) {
                color = [0.0, 1.0, 0.0, 1.0];
            }

            let r = SdfFastBorder.create(context.gl, w, h, radius, borderSize);

            let s = 1.0;
            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [w * s, h * s, 1.0]);

            r.mesh.setDrawCount(1);
            r.mesh.material.setWorldMatrix(m);
            r.mesh.material.setColor(...color);

            context.addMesh(r);
        }

        function addSdfBorder(context, w, h, borders, innerBorders, x, y, rad, scale, color) {

            if (!scale) {
                scale = 1.0;
            }

            if (!color) {
                color = [0.0, 1.0, 0.0, 1.0];
            }

            let r = SdfBorder.create(context.gl, w, h, borders, innerBorders);

            let m = mat4.create();
            mat4.identity(m);
            mat4.translate(m, m, [x, y, 0.0]);
            mat4.rotateZ(m, m, rad);
            mat4.scale(m, m, [scale * w, scale * h, 1.0]);

            r.mesh.setDrawCount(1);
            r.mesh.material.setWorldMatrix(m);
            r.mesh.material.setColor(...color);

            context.addMesh(r);
        }
    </script>
</head>

<body onload="webGLStart();" style="background-color: #000;">
    <canvas id="png_demo" width="1024" height="768" style="position:absolute; left:100px; top:100px"></canvas>
</body>

</html>